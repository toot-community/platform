containers:
  - envFrom:
  - configMapRef:
      name: {{ include "mastodon.fullname" . }}-s3-gateway
  - secretRef:
      name: {{ include "mastodon.fullname" . }}-s3-gateway-secrets
    image: "{{ .Values.s3Gateway.image.repository }}"
    imagePullPolicy: {{ .Values.s3Gateway.image.pullPolicy }}
    name: s3-gateway
    ports:
  - containerPort: 8080
    name: http
    protocol: TCP
    readinessProbe:
  {{- toYaml .Values.s3Gateway.readinessProbe | nindent 12 }}
    startupProbe:
  {{- toYaml .Values.s3Gateway.startupProbe | nindent 12 }}
    resources:
  {{- toYaml .Values.s3Gateway.resources | nindent 12 }}
    securityContext:
  {{- toYaml .Values.s3Gateway.securityContext | nindent 12 }}
    volumeMounts:
  - name: default-config-s3
    mountPath: /etc/nginx/templates/default.conf.template
    subPath: default.conf.template
restartPolicy: Always
securityContext:
  {{- toYaml .Values.s3Gateway.podSecurityContext | nindent 8 }}
serviceAccountName: {{ include "mastodon.serviceAccountName" . }}
terminationGracePeriodSeconds: 30
volumes:
  - name: default-config-s3
    configMap:
  name: default-config-s3
  items:
    - key: default.conf.template
      path: default.conf.template
