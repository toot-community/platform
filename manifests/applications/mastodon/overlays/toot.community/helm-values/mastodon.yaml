.instanceDomain: &instanceDomain toot.community
.streamingDomain: &streamingDomain streaming.toot.community
.staticDomain: &staticDomain static.toot.community

debug: false

configuration:
  localDomain: *instanceDomain
  limitedFederationMode: false
  authorizedFetch: false

  s3:
    endpoint: https://s3.eu-central-2.wasabisys.com
    hostname: s3.eu-central-2.wasabisys.com
    region: eu-central-2
    aliasHost: *staticDomain
    bucket: toot-community-assets-production
    
  smtp:
    domain: *instanceDomain
    fromAddress: toot.community Notifications <support@toot.community>
    smtpServer: mail.toot.community
    
  search:
    enabled: true

web:
  domain: *instanceDomain
  replicaCount: 3
  resources:
    requests:
      cpu: 600m
      memory: 1500Mi
    limits:
      memory: 4Gi
  
streaming:
  baseURL: wss://streaming.toot.community
  
ingress:
  web:
    host: *instanceDomain
    tls:
      - hosts:
          - *instanceDomain
        secretName: ingress-web-tls
  streaming:
    host: *streamingDomain
    tls:
      - hosts:
          - *streamingDomain
        secretName: ingress-streaming-tls

sidekiq:
  workers:
    - name: default
      concurrency: 25
      replicaCount: 3
      queues:
        - default
      resources:
        requests:
          cpu: 700m
          memory: 2Gi
        limits:
          memory: 6Gi # burstable for media processing
    - name: mailers
      concurrency: 25
      replicaCount: 1
      queues:
        - mailers
      resources: 
        requests:
          cpu: 100m
          memory: 1Gi
        limits:
          memory: 1Gi
    - name: push
      concurrency: 25
      replicaCount: 1
      queues:
        - push
      resources: 
        requests:
          cpu: 100m
          memory: 2Gi
        limits:
          memory: 2Gi
    - name: ingress
      concurrency: 25
      replicaCount: 1
      queues:
        - ingress
      resources: 
        requests:
          cpu: 1000m
          memory: 4Gi
        limits:
          memory: 6Gi
    - name: pull
      concurrency: 25
      replicaCount: 1
      queues:
        - pull
      resources: 
        requests:
          cpu: 500m
          memory: 2Gi
        limits:
          memory: 4Gi
    - name: scheduler
      concurrency: 25
      replicaCount: 1
      queues:
        - scheduler
      resources:
        requests:
          cpu: 100m
          memory: 300Mi
        limits:
          memory: 1800Mi
          
jobs:
  removePreviewCards:
    resources:
      requests:
        cpu: 500m
        memory: 400Mi
      limits:
        memory: 2000Mi
    days: 180